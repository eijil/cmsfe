"use strict";var A=Object.create;var _=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var y=(a,e)=>{for(var t in e)_(a,t,{get:e[t],enumerable:!0})},g=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of S(e))!N.call(a,r)&&r!==t&&_(a,r,{get:()=>e[r],enumerable:!(i=P(e,r))||i.enumerable});return a};var C=(a,e,t)=>(t=a!=null?A(E(a)):{},g(e||!a||!a.__esModule?_(t,"default",{value:a,enumerable:!0}):t,a)),R=a=>g(_({},"__esModule",{value:!0}),a);var B={};y(B,{ReportSDK:()=>h,webview:()=>b});module.exports=R(B);var c=require("nanoid"),u=C(require("pako"),1);var m=require("ua-parser-js"),v=a=>{a=a||(typeof window<"u"?window.navigator.userAgent:"");let e=(0,m.UAParser)(a),{device:t,ua:i,os:r}=e;return{uaParser:e,isMobile:t.type==="mobile",isFB:M(i),isAndroid:r.name==="Android",isIOS:r.name==="iOS",isTablet:t.type==="tablet",isMac:r.name==="Mac OS",isApp:location.search.includes("rsApp")}},M=a=>/FBAN|FBAV|FB_IAB|FB_IABV_SIMULATOR/.test(a);var w=require("buffer"),o=v(),f={},l=class a{VERSION;APP_ID;CHANNEL_ID;PACKAGE_NAME;REPORT_API;static instance;constructor(e){this.REPORT_API=e.reportAPI,this.VERSION=e.version,this.APP_ID=e.appId,this.CHANNEL_ID=e.channelId,this.PACKAGE_NAME=e.packageName||"h5"}static getInstance(e){return a.instance||(a.instance=new a(e)),a.instance}eventReport({event_name:e,sub_event_name:t,properties:i,ctime:r},n){if(n&&f[n])return;let s={_event_name:e,_sub_event_name:t,properties:i};try{this.reportHandle(s,r)}catch(p){console.log("\u4E0A\u62A5\u5931\u8D25",p)}n&&(f[n]=!0)}pageEnter(e){this.reportHandle({_event_name:"m_page_enter",properties:{...e,_referrer_url:document==null?void 0:document.referrer}})}installReport(){let{uaParser:e}=o,t="";o.isMobile?t="phone":o.isTablet?t="tablet":o.isMac?t="mac":t="pc",localStorage.getItem("_app_install_id")||this.reportHandle({_event_name:"m_app_install",properties:{_device_brand:"",_device_model:"",_device_screen_h:window.screen.height,_device_screen_w:window.screen.width,_device_ram:0,_device_lang:"en",_device_category:t,browser_brand:e.browser.name,browser_version:e.browser.version,_ua:navigator.userAgent,_url:window.location.href,_referrer_url:document==null?void 0:document.referrer}})}getBaseInfo(){let{uaParser:e}=o,t=e.os.name?e.os.name.toLowerCase():"",i={_app_id:this.APP_ID,_app_channel_id:this.CHANNEL_ID,_app_version:this.VERSION,_package_name:this.PACKAGE_NAME,_app_game_version:"",_app_res_version:"",_app_install_id:localStorage.getItem("_app_install_id")||"",_app_activate_id:sessionStorage.getItem("_app_activate_id")||"",_device_id:"",_ad_id:"",_androidid:"",_idfv:"",_os_type:t,_os_version:"",_os_timezone_offset:"utc_offset=-8:00",_os_timestamp:Math.floor(new Date().getTime()/1e3),_device_network_type:0,_app_user_id:localStorage.getItem("uid")||"",_app_lang:(navigator==null?void 0:navigator.language)||(navigator==null?void 0:navigator.userLanguage)||"",_event_name:"",_sub_event_name:"",properties:{}},r=new Date().getTimezoneOffset()/60,n=(new Date().getTimezoneOffset()%60).toString().padStart(2,"0");if(i._os_timezone_offset=`utc_offset=${r}:${n}`,!localStorage.getItem("_app_install_id")){let s=(0,c.nanoid)();i._app_install_id=s,localStorage.setItem("_app_install_id",s.toString())}if(!sessionStorage.getItem("_app_activate_id")){let s=(0,c.nanoid)();i._app_activate_id=s,sessionStorage.setItem("_app_activate_id",s.toString())}return i}reportHandle(e,t){let i=this.getBaseInfo();t&&(i._os_timestamp=t);let r={...i,...e};this.send(r)}async send(e){console.log("\u4E0A\u62A5\u4FE1\u606F",e);let t=u.default.deflate(JSON.stringify([e])),i=w.Buffer.from(t);return await fetch(this.REPORT_API,{method:"POST",body:i.toString("base64")}).catch(n=>{console.log("\u4E0A\u62A5\u5931\u8D25",n)})}},h=l;var I="webToNative",T="nativeToWeb",d=class{nativeCallbacks=new Map;constructor(){typeof window>"u"||this.registerCallback()}registerCallback(){window[T]=e=>{var t;try{typeof e=="string"&&(e=JSON.parse(e));let{id:i,name:r}=e;(t=this.nativeCallbacks.get(`${i}_${r}`))==null||t(e)}catch(i){console.log(i)}}}exec(e,t){let{callback:i,...r}=t||{},n=Date.now().toString(),s={id:n,name:e,params:r};try{this.postMessage(s)}catch(p){console.log(p)}return i&&this.nativeCallbacks.set(`${n}_${e}`,i),s}postMessage=e=>{if(window.webkit){let t={...e,params:e.params};this.iosMessage(t)}else window!=null&&window.Android&&this.androidMessage(JSON.stringify(e))};iosMessage=e=>{var i;let t=(i=window.webkit)==null?void 0:i.messageHandlers[I];if(!t)throw new Error("\u7248\u672C\u8FC7\u4F4E");t.postMessage(e)};androidMessage=e=>{window==null||window.Android[I](e)}},b=new d;0&&(module.exports={ReportSDK,webview});
//# sourceMappingURL=index.cjs.map